<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suppression - D√©mo Stock Admin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .success {
            background: #28a745;
        }
        .success:hover {
            background: #218838;
        }
        .danger {
            background: #dc3545;
        }
        .danger:hover {
            background: #c82333;
        }
        .warning {
            background: #ffc107;
            color: #212529;
        }
        .warning:hover {
            background: #e0a800;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóëÔ∏è Suppression - D√©mo Stock Admin</h1>
        <p><strong>Suppression compl√®te de toutes les donn√©es de d√©monstration dans l'interface admin.</strong></p>
        
        <div id="status" class="status warning">
            Pr√™t √† supprimer les donn√©es de d√©mo...
        </div>
        
        <div class="grid">
            <div class="section">
                <h2>üîç Identification</h2>
                <button class="button" onclick="identifyDemoData()">Identifier les donn√©es de d√©mo</button>
                <button class="button" onclick="checkAdminInterface()">V√©rifier l'interface admin</button>
                <div id="identification" class="log"></div>
            </div>
            
            <div class="section">
                <h2>üóëÔ∏è Suppression</h2>
                <button class="button danger" onclick="removeDemoStock()">Supprimer D√©mo Stock</button>
                <button class="button danger" onclick="removeAllDemoData()">Supprimer toutes les donn√©es de d√©mo</button>
                <button class="button warning" onclick="cleanAdminInterface()">Nettoyer l'interface admin</button>
                <div id="removal" class="log"></div>
            </div>
        </div>
        
        <div class="section">
            <h2>üßπ Nettoyage</h2>
            <button class="button" onclick="cleanLocalStorage()">Nettoyer localStorage</button>
            <button class="button" onclick="removeTestFiles()">Supprimer fichiers de test</button>
            <button class="button success" onclick="verifyCleanState()">V√©rifier l'√©tat propre</button>
            <div id="cleanup" class="log"></div>
        </div>
        
        <div class="section">
            <h2>üß™ Test Final</h2>
            <button class="button success" onclick="finalTest()">Test final</button>
            <button class="button" onclick="goToAdmin()">Aller √† l'admin</button>
            <div id="test" class="log"></div>
        </div>
    </div>

    <script>
        function log(message, targetId = 'identification') {
            const logElement = document.getElementById(targetId);
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStatus(message, type = 'warning') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        function identifyDemoData() {
            log('üîç IDENTIFICATION DES DONN√âES DE D√âMO');
            log('='.repeat(45));
            
            // V√©rifier les cl√©s localStorage li√©es aux d√©mos
            const demoKeys = [
                'demoProducts',
                'demoSales',
                'demoOrders',
                'demoUsers',
                'demoStockMovements',
                'demoData',
                'testData',
                'sampleData'
            ];
            
            log('\nüìä CL√âS LOCALSTORAGE DE D√âMO:');
            let foundDemoData = false;
            
            demoKeys.forEach(key => {
                const value = localStorage.getItem(key);
                if (value) {
                    try {
                        const parsed = JSON.parse(value);
                        const count = Array.isArray(parsed) ? parsed.length : 'N/A';
                        log(`‚ùå ${key}: ${count} √©l√©ments de d√©mo trouv√©s`);
                        foundDemoData = true;
                    } catch (e) {
                        log(`‚ùå ${key}: Donn√©es corrompues`);
                        foundDemoData = true;
                    }
                } else {
                    log(`‚úÖ ${key}: Aucune donn√©e de d√©mo`);
                }
            });
            
            // V√©rifier les donn√©es r√©guli√®res pour des √©l√©ments de test
            const regularKeys = [
                'koula_products',
                'salesData',
                'ordersData',
                'users',
                'stockMovements'
            ];
            
            log('\nüìä V√âRIFICATION DES DONN√âES R√âGULI√àRES:');
            regularKeys.forEach(key => {
                const value = localStorage.getItem(key);
                if (value) {
                    try {
                        const parsed = JSON.parse(value);
                        if (Array.isArray(parsed)) {
                            // V√©rifier s'il y a des √©l√©ments de test
                            const testItems = parsed.filter(item => 
                                item.name && (
                                    item.name.toLowerCase().includes('test') ||
                                    item.name.toLowerCase().includes('demo') ||
                                    item.name.toLowerCase().includes('exemple') ||
                                    item.name.toLowerCase().includes('sample')
                                )
                            );
                            
                            if (testItems.length > 0) {
                                log(`‚ö†Ô∏è  ${key}: ${testItems.length} √©l√©ments de test trouv√©s`);
                                testItems.forEach(item => {
                                    log(`   - ${item.name}`);
                                });
                                foundDemoData = true;
                            } else {
                                log(`‚úÖ ${key}: Aucun √©l√©ment de test (${parsed.length} √©l√©ments)`);
                            }
                        }
                    } catch (e) {
                        log(`‚ùå ${key}: Donn√©es corrompues`);
                    }
                } else {
                    log(`‚úÖ ${key}: Aucune donn√©e`);
                }
            });
            
            if (foundDemoData) {
                log('\n‚ö†Ô∏è  DONN√âES DE D√âMO D√âTECT√âES - Suppression recommand√©e');
                updateStatus('Donn√©es de d√©mo d√©tect√©es', 'error');
            } else {
                log('\n‚úÖ AUCUNE DONN√âE DE D√âMO D√âTECT√âE');
                updateStatus('Aucune donn√©e de d√©mo d√©tect√©e', 'success');
            }
        }

        function checkAdminInterface() {
            log('üîç V√âRIFICATION DE L\'INTERFACE ADMIN:', 'identification');
            log('='.repeat(40), 'identification');
            
            // V√©rifier si la page StockDemo existe
            log('üìÑ Fichiers admin √† v√©rifier:', 'identification');
            log('   - StockDemo.js (√† supprimer)', 'identification');
            log('   - AdminSimpleComplete.js (√† nettoyer)', 'identification');
            log('', 'identification');
            
            // V√©rifier les routes admin
            log('üõ£Ô∏è  Routes admin √† v√©rifier:', 'identification');
            log('   - /admin/stock-demo (√† supprimer)', 'identification');
            log('   - D√©mo Stock dans le menu (√† supprimer)', 'identification');
            log('', 'identification');
            
            log('üí° ACTIONS N√âCESSAIRES:', 'identification');
            log('   1. Supprimer le fichier StockDemo.js', 'identification');
            log('   2. Retirer "D√©mo Stock" du menu admin', 'identification');
            log('   3. Nettoyer les imports dans AdminSimpleComplete.js', 'identification');
            log('   4. Supprimer les donn√©es de d√©mo du localStorage', 'identification');
        }

        function removeDemoStock() {
            log('üóëÔ∏è SUPPRESSION DE LA D√âMO STOCK:', 'removal');
            log('='.repeat(35), 'removal');
            
            try {
                // 1. Supprimer les donn√©es de d√©mo du localStorage
                const demoKeys = [
                    'demoProducts',
                    'demoSales',
                    'demoOrders',
                    'demoUsers',
                    'demoStockMovements',
                    'demoData',
                    'testData',
                    'sampleData'
                ];
                
                let removedCount = 0;
                demoKeys.forEach(key => {
                    if (localStorage.getItem(key)) {
                        localStorage.removeItem(key);
                        removedCount++;
                        log(`‚úÖ Cl√© ${key} supprim√©e`, 'removal');
                    }
                });
                
                // 2. Nettoyer les donn√©es r√©guli√®res des √©l√©ments de test
                const regularKeys = [
                    'koula_products',
                    'salesData',
                    'ordersData',
                    'users',
                    'stockMovements'
                ];
                
                regularKeys.forEach(key => {
                    const value = localStorage.getItem(key);
                    if (value) {
                        try {
                            const parsed = JSON.parse(value);
                            if (Array.isArray(parsed)) {
                                // Filtrer les √©l√©ments de test
                                const cleanedData = parsed.filter(item => 
                                    !(item.name && (
                                        item.name.toLowerCase().includes('test') ||
                                        item.name.toLowerCase().includes('demo') ||
                                        item.name.toLowerCase().includes('exemple') ||
                                        item.name.toLowerCase().includes('sample')
                                    ))
                                );
                                
                                if (cleanedData.length !== parsed.length) {
                                    localStorage.setItem(key, JSON.stringify(cleanedData));
                                    log(`‚úÖ ${parsed.length - cleanedData.length} √©l√©ments de test supprim√©s de ${key}`, 'removal');
                                    removedCount++;
                                }
                            }
                        } catch (e) {
                            log(`‚ùå Erreur lors du nettoyage de ${key}`, 'removal');
                        }
                    }
                });
                
                log(`‚úÖ ${removedCount} √©l√©ments de d√©mo supprim√©s`, 'removal');
                updateStatus('D√©mo Stock supprim√©e', 'success');
                
            } catch (error) {
                log(`‚ùå Erreur: ${error.message}`, 'removal');
                updateStatus('Erreur lors de la suppression', 'error');
            }
        }

        function removeAllDemoData() {
            log('üóëÔ∏è SUPPRESSION DE TOUTES LES DONN√âES DE D√âMO:', 'removal');
            
            // Supprimer toutes les cl√©s qui contiennent "demo", "test", "sample"
            const allKeys = Object.keys(localStorage);
            const demoKeys = allKeys.filter(key => 
                key.toLowerCase().includes('demo') ||
                key.toLowerCase().includes('test') ||
                key.toLowerCase().includes('sample') ||
                key.toLowerCase().includes('exemple')
            );
            
            demoKeys.forEach(key => {
                localStorage.removeItem(key);
                log(`‚úÖ ${key} supprim√©e`, 'removal');
            });
            
            log(`‚úÖ ${demoKeys.length} cl√©s de d√©mo supprim√©es`, 'removal');
            updateStatus('Toutes les donn√©es de d√©mo supprim√©es', 'success');
        }

        function cleanAdminInterface() {
            log('üßπ NETTOYAGE DE L\'INTERFACE ADMIN:', 'removal');
            log('='.repeat(40), 'removal');
            
            log('üìã ACTIONS √Ä EFFECTUER MANUELLEMENT:', 'removal');
            log('', 'removal');
            log('1. Supprimer le fichier: client/src/pages/admin/StockDemo.js', 'removal');
            log('2. Modifier client/src/pages/admin/AdminSimpleComplete.js:', 'removal');
            log('   - Supprimer: import StockDemo from \'./StockDemo\';', 'removal');
            log('   - Supprimer: { name: \'D√©mo Stock\', tab: \'stock-demo\', icon: Package },', 'removal');
            log('   - Supprimer: case \'stock-demo\': return <StockDemo />;', 'removal');
            log('', 'removal');
            log('3. V√©rifier qu\'aucune route ne pointe vers /admin/stock-demo', 'removal');
            log('', 'removal');
            log('‚úÖ Ces modifications supprimeront compl√®tement la section D√©mo Stock', 'removal');
            
            updateStatus('Instructions de nettoyage fournies', 'warning');
        }

        function cleanLocalStorage() {
            log('üßπ NETTOYAGE DU LOCALSTORAGE:', 'cleanup');
            
            // Supprimer toutes les cl√©s temporaires et de test
            const allKeys = Object.keys(localStorage);
            const keysToRemove = allKeys.filter(key => 
                key.includes('temp_') ||
                key.includes('cache_') ||
                key.includes('backup_') ||
                key.includes('_backup') ||
                key.includes('test_') ||
                key.includes('_test')
            );
            
            keysToRemove.forEach(key => {
                localStorage.removeItem(key);
                log(`‚úÖ ${key} supprim√©e`, 'cleanup');
            });
            
            log(`‚úÖ ${keysToRemove.length} cl√©s temporaires supprim√©es`, 'cleanup');
            updateStatus('localStorage nettoy√©', 'success');
        }

        function removeTestFiles() {
            log('üóëÔ∏è FICHIERS DE TEST √Ä SUPPRIMER:', 'cleanup');
            log('='.repeat(35), 'cleanup');
            
            const testFiles = [
                'test-simple-persistence.html',
                'test-product-persistence.html',
                'test-stock-movements-final.html',
                'test-admin-fix.html',
                'debug-product-persistence.html',
                'debug-product-disappearance.html',
                'diagnose-complete-admin-issue.html',
                'fix-stock-movements.html',
                'force-fix-stock-movements.html',
                'test-debt-reset.html',
                'test-debt-nan-fix.html',
                'test-real-data-only.html'
            ];
            
            log('üìÑ Fichiers de test √† supprimer manuellement:', 'cleanup');
            testFiles.forEach(file => {
                log(`   - ${file}`, 'cleanup');
            });
            
            log('', 'cleanup');
            log('üí° Ces fichiers peuvent √™tre supprim√©s car ils ne sont plus n√©cessaires', 'cleanup');
            log('   apr√®s la correction des probl√®mes de persistance.', 'cleanup');
        }

        function verifyCleanState() {
            log('‚úÖ V√âRIFICATION DE L\'√âTAT PROPRE:', 'cleanup');
            log('='.repeat(35), 'cleanup');
            
            // V√©rifier qu'il n'y a plus de donn√©es de d√©mo
            const demoKeys = [
                'demoProducts',
                'demoSales',
                'demoOrders',
                'demoUsers',
                'demoStockMovements',
                'demoData',
                'testData',
                'sampleData'
            ];
            
            let cleanState = true;
            demoKeys.forEach(key => {
                if (localStorage.getItem(key)) {
                    log(`‚ùå ${key}: Toujours pr√©sent`, 'cleanup');
                    cleanState = false;
                } else {
                    log(`‚úÖ ${key}: Absent`, 'cleanup');
                }
            });
            
            // V√©rifier les donn√©es r√©guli√®res
            const regularKeys = [
                'koula_products',
                'salesData',
                'ordersData',
                'users',
                'stockMovements'
            ];
            
            log('', 'cleanup');
            log('üìä DONN√âES R√âGULI√àRES:', 'cleanup');
            regularKeys.forEach(key => {
                const value = localStorage.getItem(key);
                if (value) {
                    try {
                        const parsed = JSON.parse(value);
                        if (Array.isArray(parsed)) {
                            const testItems = parsed.filter(item => 
                                item.name && (
                                    item.name.toLowerCase().includes('test') ||
                                    item.name.toLowerCase().includes('demo') ||
                                    item.name.toLowerCase().includes('exemple')
                                )
                            );
                            
                            if (testItems.length === 0) {
                                log(`‚úÖ ${key}: Propre (${parsed.length} √©l√©ments)`, 'cleanup');
                            } else {
                                log(`‚ö†Ô∏è  ${key}: ${testItems.length} √©l√©ments de test restants`, 'cleanup');
                                cleanState = false;
                            }
                        }
                    } catch (e) {
                        log(`‚ùå ${key}: Donn√©es corrompues`, 'cleanup');
                        cleanState = false;
                    }
                } else {
                    log(`‚úÖ ${key}: Vide`, 'cleanup');
                }
            });
            
            if (cleanState) {
                log('', 'cleanup');
                log('üéâ √âTAT PROPRE CONFIRM√â - Aucune donn√©e de d√©mo d√©tect√©e', 'cleanup');
                updateStatus('‚úÖ √âtat propre confirm√©', 'success');
            } else {
                log('', 'cleanup');
                log('‚ö†Ô∏è  NETTOYAGE SUPPL√âMENTAIRE N√âCESSAIRE', 'cleanup');
                updateStatus('‚ö†Ô∏è  Nettoyage suppl√©mentaire n√©cessaire', 'warning');
            }
        }

        function finalTest() {
            log('üß™ TEST FINAL:', 'test');
            log('='.repeat(20), 'test');
            
            // V√©rifier l'√©tat final
            const hasDemoData = Object.keys(localStorage).some(key => 
                key.toLowerCase().includes('demo') ||
                key.toLowerCase().includes('test') ||
                key.toLowerCase().includes('sample')
            );
            
            if (!hasDemoData) {
                log('‚úÖ Aucune donn√©e de d√©mo d√©tect√©e', 'test');
                log('‚úÖ Interface admin pr√™te pour les vraies donn√©es', 'test');
                log('üéâ TEST FINAL R√âUSSI', 'test');
                updateStatus('‚úÖ Test final r√©ussi - Interface propre', 'success');
            } else {
                log('‚ùå Des donn√©es de d√©mo sont encore pr√©sentes', 'test');
                log('üí° Ex√©cutez "Supprimer toutes les donn√©es de d√©mo"', 'test');
                updateStatus('‚ùå Nettoyage suppl√©mentaire n√©cessaire', 'error');
            }
        }

        function goToAdmin() {
            window.location.href = 'http://localhost:3002/admin';
        }

        // V√©rification automatique au chargement
        window.onload = function() {
            log('üöÄ Page de suppression des donn√©es de d√©mo charg√©e');
            identifyDemoData();
        };
    </script>
</body>
</html>
