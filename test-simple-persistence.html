<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Simple - Persistance</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .success {
            background: #28a745;
        }
        .success:hover {
            background: #218838;
        }
        .danger {
            background: #dc3545;
        }
        .danger:hover {
            background: #c82333;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            background: #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Simple - Persistance des Produits</h1>
        <p>Test basique pour v√©rifier que les produits persistent correctement.</p>
        
        <div class="status" id="status">
            Pr√™t √† tester...
        </div>
        
        <div>
            <button class="button" onclick="addProduct()">Ajouter un produit</button>
            <button class="button" onclick="showProducts()">Afficher les produits</button>
            <button class="button success" onclick="testPersistence()">Tester la persistance</button>
            <button class="button danger" onclick="clearProducts()">Vider les produits</button>
        </div>
        
        <div class="log" id="log"></div>
    </div>

    <script>
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.style.background = type === 'success' ? '#d4edda' : 
                                           type === 'error' ? '#f8d7da' : '#e9ecef';
        }

        function addProduct() {
            const product = {
                _id: Date.now().toString(),
                name: 'Produit Test ' + new Date().toLocaleTimeString(),
                description: 'Description du produit test',
                price: Math.floor(Math.random() * 50000) + 10000,
                stock: Math.floor(Math.random() * 20) + 1,
                productType: 'construction',
                category: 'Test',
                featured: false,
                isPublished: true,
                images: [],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            try {
                // R√©cup√©rer les produits existants
                const products = JSON.parse(localStorage.getItem('koula_products') || '[]');
                
                // Ajouter le nouveau produit
                products.push(product);
                
                // Sauvegarder
                localStorage.setItem('koula_products', JSON.stringify(products));
                
                log(`‚úÖ Produit ajout√©: ${product.name}`);
                log(`üìä Total produits: ${products.length}`);
                
                updateStatus(`Produit ajout√©: ${product.name}`, 'success');
                
            } catch (error) {
                log(`‚ùå Erreur: ${error.message}`);
                updateStatus('Erreur lors de l\'ajout', 'error');
            }
        }

        function showProducts() {
            log('üì¶ PRODUITS ACTUELS:');
            log('='.repeat(30));
            
            try {
                const products = JSON.parse(localStorage.getItem('koula_products') || '[]');
                
                if (products.length === 0) {
                    log('‚ö™ Aucun produit trouv√©');
                } else {
                    products.forEach((product, index) => {
                        log(`\n${index + 1}. ${product.name}`);
                        log(`   ID: ${product._id}`);
                        log(`   Prix: ${product.price} FG`);
                        log(`   Stock: ${product.stock}`);
                        log(`   Publi√©: ${product.isPublished ? 'Oui' : 'Non'}`);
                        log(`   Cr√©√©: ${new Date(product.createdAt).toLocaleString()}`);
                    });
                }
                
                updateStatus(`${products.length} produits trouv√©s`, 'success');
                
            } catch (error) {
                log(`‚ùå Erreur: ${error.message}`);
                updateStatus('Erreur lors de l\'affichage', 'error');
            }
        }

        function testPersistence() {
            log('üß™ TEST DE PERSISTANCE:');
            log('='.repeat(30));
            
            const testProduct = {
                _id: 'persistence-test-' + Date.now(),
                name: 'Test Persistance ' + new Date().toLocaleTimeString(),
                description: 'Test de persistance',
                price: 25000,
                stock: 10,
                productType: 'construction',
                category: 'Test',
                featured: false,
                isPublished: true,
                images: [],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            try {
                // 1. Sauvegarder
                log('√âtape 1: Sauvegarde...');
                const products = JSON.parse(localStorage.getItem('koula_products') || '[]');
                products.push(testProduct);
                localStorage.setItem('koula_products', JSON.stringify(products));
                log('‚úÖ Produit sauvegard√©');
                
                // 2. V√©rifier imm√©diatement
                log('√âtape 2: V√©rification imm√©diate...');
                const verification1 = JSON.parse(localStorage.getItem('koula_products') || '[]');
                const found1 = verification1.find(p => p._id === testProduct._id);
                if (found1) {
                    log('‚úÖ Produit trouv√© apr√®s sauvegarde');
                } else {
                    log('‚ùå Produit non trouv√© apr√®s sauvegarde');
                    return;
                }
                
                // 3. Simuler un rechargement
                log('√âtape 3: Simulation de rechargement...');
                const reloaded = JSON.parse(localStorage.getItem('koula_products') || '[]');
                const found2 = reloaded.find(p => p._id === testProduct._id);
                if (found2) {
                    log('‚úÖ Produit trouv√© apr√®s rechargement');
                    log('üéâ TEST DE PERSISTANCE R√âUSSI !');
                    updateStatus('‚úÖ Test de persistance r√©ussi', 'success');
                } else {
                    log('‚ùå Produit perdu apr√®s rechargement');
                    updateStatus('‚ùå Test de persistance √©chou√©', 'error');
                }
                
            } catch (error) {
                log(`‚ùå Erreur: ${error.message}`);
                updateStatus('‚ùå Erreur lors du test', 'error');
            }
        }

        function clearProducts() {
            if (confirm('√ätes-vous s√ªr de vouloir vider tous les produits ?')) {
                localStorage.removeItem('koula_products');
                log('‚úÖ Tous les produits supprim√©s');
                updateStatus('Produits supprim√©s', 'warning');
            }
        }

        // Test automatique au chargement
        window.onload = function() {
            log('üöÄ Page de test simple charg√©e');
            showProducts();
        };
    </script>
</body>
</html>
